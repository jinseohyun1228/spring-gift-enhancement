# spring-gift-wishlist

`🎯 유효성 검사를 실시하자`

***

## 기능 요구 사항
>- 상품 이름은 공백을 포함하여 최대 15자까지 입력할 수 있다.   
>- 가능한 특수 문자 : ( ), [ ], +, -, &, /, _ 
>    그 외 특수 문자 사용 불가    
>- "카카오"가 포함된 문구는 담당 MD와 협의한 경우에만 사용할 수 있다.

결국 _"유효성 검사를 실시하고 적절한 위치를 찾는 것"_ 을 배우는 게 이번 과제의 뜻이겠지??


***

### 현재 구조와 변경 구조
```text
  컨트롤러  --- 레파지토리 --- 데이터베이스(h2)
      |          
 응답객체매퍼  
```

### 변경 구조
```text
  컨트롤러    --- 서비스 --- 레파지토리 --- 데이터베이스(h2)
                 /  \    
      유효성검사객체   응답객체매퍼
```

## 구현 예정 목록
1. 서비스 단 구현 ✔️
2. 유효성 검사 객체 구현 ✔️ 
3. 서비스 단에서 유효성 검사 객체를 사용 ✔️
4. 예외 클래스 작성
5. 예외 발생시 처리하는 `@ControllerAdvice` 만들기


## 현재 구현의 문제점
```text
아래 내용을 계속 고민하면서, 이리저리 리팩토링만 계속 하다가
멘토님께 상황을 공유하고, 도움을 받는게 좋을 것 같아서 남깁니다.
```

### 1. 의도와 다르게 구현된다.
**내 의도**
>- 컨트롤러에는 로직을 담지 말자   

제가 생각하는 컨트롤러는 _"요청 객체를 전달하고,  응답객체를 다시 전달한다."_ 였습니다.   
그래서 컨트롤러에서는 요청 객체를 서비스에게 그대로 전달만하고, 에러 핸들러나 로직을 담고 싶지 않았습니다.   

따라서 유효성 검증을 서비스 단에서 담당하게 하고 싶었습니다.



**실제 동작**
>- 컨트롤러가 실제 로직을 담당한다.

그러나 서비스 메서드 파라미터에서 유효성 검사를 받기 위해서 결국 컨트롤러에서 `new Product`로직을 추가해야했습니다.   

컨트롤러는 응답 객체를 전달하기만 하자!라는 제 의도 대로 구현되지 않고,
서비스 단에서 유효성 검사하는 것이 오히려 코드의 로직을 복잡하게 만드는 문제점이 있습니다.



### 2. 서비스에서 유효성을 검사하면서 생긴 문제
>- 에러메시지를 해당 페이지에 넣을 수 없고 새로운 페이지를 반환한다.

`BindingResult` 를 컨트롤러 메서드 파라미터로 받을 수 있다면 타임리프 탬플릿에 에러메시지를 넣어서 서버사이드 방식으로 웹페이지를 만들 수있습니다.

그러나 저는 서비스에서 유효성 검사를 하기 때문에, 에러 페이지를 페이지에 담기 힘들어 따로 에러 페이지를 만들고 있습니다.
### 3. 유효성 검사가 두번 진행된다.
> 처음 요청 객체인 ProductRequest에서도 int에 대한 유효성 검사가 진행됩니다.

int 필드는 null일 수 없기 때문에 null 값이 들어오면 에러가 발생해서 결국 에러페이지가 반환됩니다.
즉, 유효성 검사를 하게 됩니다.

컨트롤러에서 유효성 검사를 하지 않기 위해 서비스 단에서 진행하는 것인데, 
애초에 컨트롤러에서 유효성 검사를 하고 있다면 현재 서비스단에서 유효성검사를 하는 의미가 있나 싶습니다.



## 어떻게 고치면 좋읗지

### 1. 어노테이션 기반이 아닌, 유효성 검사 메서드를 사용한다.
여기에 담지는 않았지만, 저는 메서드 기반 유효성 검사를 먼저 구현해밨습니다.   
그러나 과제 힌트에 `@vaild`를 이용하라는 이야기가 있어 어노테이션 유효성 검사로직을 구현하였습니다.

1. 유효성 검사 메서드를 구현한다면, 유효성 시점을 알기 쉽고, 변경이 더 편리하다.


2. 다른 위치에서도 유효성 검증을 하기 쉽다.    
    ```
    그러나 추가로 알아보았을 때, 
    "유효성 검사는 중복 진행 시 
    어플리케이션 성능에 무리가 가기 때문에 한 곳에서 진행하는 것이 적절했습니다.

    그런 면에서는 더더욱 컨트롤러 메서드 요청 객체에서 유효성 검사를 한다면, 
    유효한 객체만 전달 되기 때문에 다른 곳에서 유효성 검사를 진행할 필요가 없고, 해당 객체으 ㅣ
    안정성이 올라갈 것 같습니다.
    ```


### 2. 컨트롤러 메서드에서 파라미터로 받는 요청 객체에서 유효성 검사를 진행한다.
`에러 메시지를 담기 편리하다.`   

`어처피 요청 객체에서 유효성 검사를 진행하고 있다.`   

등등 위에서 적었던 대로, 컨트롤러 메서드에서 진행하는 것이 적절할 것 같습니다.
기본적으로 ``@Vaild``는 컨트롤러에서 사용하도록 되어있습니다.

처음에는 "서비스단에서 추가로 `@Validated`를 사용하면 되겠다"라고 생각했는데,   
선배 개발자들이 컨트롤러에서 사용하도록 한 것에는 역시 이유가 있는 것 아닐까 .... 라고 생각이 들었습니다.

또한 동료 개발자들도 컨트롤러에서 진행하는 것으로 예상할 것이기 때문에,   
예상에 부응하는 코드를 만들어야하지 않나... 라는 고민점이 있습니다.





### 3. 예외핸들러에서 기본 페이지에 각각의 에러 메시지를 담아 기본 페이지를 반환한다.
지금 예외핸들러에서 error 페이지를 반환하고 있습니다.
그러나 예외 핸들어에서도 충분히 Product 탬플릿을 반환할 수 있습니다. 전체 객체만 채우고, 에러 메시지를 추가로 모델에 담으면 되니까요...(?)
하지만 그렇게 되면 예외 핸들러의 로직이 너무 복잡해진다는 문제점이 발생할 것 같습니다.
또한 현재 방식에 문제점들이 존재하는데도 이런 복잡한 로직을 고수하기 보다는 차라리 컨트롤러에서 유효성 검사를 하고 `BindingResult`를 받는 것이 적절할 것 같습니다.




## 고민을 하면서 느낀 것
#### _그냥 전형적인 패턴을 따라가는 것이 좋지 않나?_
화요일 밤에 구현을 완료했으나 이런저런 고민들로 코드가 복잡하고, 정리되어있지 않다는 생각에 
목요일 아침까지 리팩토링만 한 것 같습니다. 

`@Vaild`는 컨트롤러에서 쓰는 것이 일반적입니다.     
만약 바로 컨트롤러에서 그렇게 구현했다면, 시간도 단축할 수 있고 step2도 더 빠르게 시작할 수 있었을 것 같다는 아쉬움이 있습니다.


> 일반적인 흐름을 따라서 개발한다면 시간도 단축하고,    
구현이후에도 `코드를 통해서 왜 이게 일반적인지에 대한 이유`를 충분히 배울 수 있지 않나.

또한 그것이 효율적인 방법이 아닐까 생각합니다.    
지금은 혼자 개발을 하니 상관없지만, 실제 팀원들과 구현을 한다면 이런 것에 시간을 많이 잡아먹게 되고   
그것이 문제가 될 수도 있을 것 같습니다.

멘토님은 어떻게 생각하시는지 궁금합니다..!!

